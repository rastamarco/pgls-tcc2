<nav class="navbar navbar-expand-sm bg-primary navbar-dark">
  <ul class="navbar-nav">
    <li class="nav-item active">
      <a class="nav-link" href="/dashboard/admin">Painel do Administrador</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="/dashboard">PGLS-UTFPR</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="/dashboard/resultados">Resultados</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="/dashboard/apuracoes">Apurações</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="/dashboard/admin">Painel do Adminstrador</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="/dashboard/busca_inserir">Busca/Anexar</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="/users/logout">Desconectar</a>
    </li>
  </ul>
</nav>
<!-- Navegação -->
<a name="Home">Home </a>|
<a href="#secao1">Cadastros </a>|
<a href="#secao2">Dados PGLS </a>|
<a href="#secao3"> Listar Conteúdos</a>
<!-- Fim Navegação -->


<h5 class="text-center mb-3" style="margin-top: 20px"> <a name="secao1">Painel do Administrador</a></h5>
<div class="container">
  <% include ./partials/messages %>
  <!-- Cadastros de Funcionários e Comissão -->
  <div class="row">
    <!-- Cadastro de Funcionários-->
    <div class="col-lg" style="margin-top: 30px">
      <h5 class="text-center mb-3" name="secao1"><i class="fas fa-user-plus"></i> Cadastro de Funcionários</h5>

      <form action="/dashboard/admin1" method="POST">
        <div class="form-group">
          <label for="name">Nome</label>
          <input type="name" id="name" name="name" class="form-control" placeholder="Digite o nome"
            value="<%= typeof name != 'undefined' ? name : '' %>" />
        </div>
        <div class="form-group">
          <label for="email">Email</label>
          <input type="email" id="email" name="email" class="form-control" placeholder="Digite o Email"
            value="<%= typeof email != 'undefined' ? email : '' %>" />
        </div>
        <div class="form-group">
          <label for="funct">Função</label>
          <input type="name" id="funct" name="funct" class="form-control" placeholder="Digite a Função"
            value="<%= typeof name != 'undefined' ? name : '' %>" />
        </div>

        <div class="form-group">
          <label for="password">Senha</label>
          <input type="password" id="password" name="password" class="form-control" placeholder="Informe a Senha"
            value="<%= typeof password != 'undefined' ? password : '' %>" />
        </div>
        <button type="submit" id="cadastrarFuncionario" class="btn btn-primary btn-block">Cadastrar Funcionário</button>
      </form>
    </div>
    <!-- Cadastro Comissão-->
    <div class="col-lg" style="margin-top: 30px">
      <h5 class="text-center mb-3"><i class="fas fa-users"></i> Cadastro de Comissão</h5>
      <form action="/dashboard/admin2" method="POST">
        <label for="indicador"> Selecione o Indicador</label>
        <select id="indicador" name="indicador" class="custom-select">
          <% for (var i = 0; i < indicador.length ;i++ ) {%>
          <option value="<%= indicador[i].nome %>"> <%= indicador[i].nome %> </option>
          <% } %>
        </select>
        <br><br>

        <label for="nomeFuncionario"> Selecione o funcionário</label>
        <select id="nomeFuncionario" name="nomeFuncionario" class="custom-select">
          <% for (var i = 0; i < usuarios.length ;i++ ) {%>
          <option value="<%= usuarios[i].name %>"> <%= usuarios[i].name %> </option>
          <% } %>
        </select>
        <br><br>
        <button type="submit" class="btn btn-primary btn-block">Adicionar na Comissão</button>
      </form>
    </div>
    <!-- Cadastro de Empresas-->
    <div class="col-lg" style="margin-top: 30px">
      <h5 class="text-center mb-3" name="secao1"><i class="fas fa-building"></i> Cadastro de Empresas</h5>

      <form action="/dashboard/adminEmpresa" method="POST" enctype="application/x-www-form-urlencoded">
        <div class="form-group">
          <label for="razao_social">Razão Social</label>
          <input type="name" id="razao_social" name="razao_social" class="form-control" placeholder="Razão Social"
            value="<%= typeof name != 'undefined' ? name : '' %>" />
        </div>
        <div class="form-group">
          <label for="nome_fantasia">Nome Fantasia</label>
          <input type="name" id="nome_fantasia" name="nome_fantasia" class="form-control" placeholder="Nome Fantasia"
            value="<%= typeof name != 'undefined' ? name : '' %>" />
        </div>
        <div class="form-group">
          <label for="t_licensa_ambiental">Tipo de Licença Ambiental</label>
          <input type="name" id="t_licensa_ambiental" name="t_licensa_ambiental" class="form-control"
            placeholder="Tipo de Licença Ambiental" value="<%= typeof name != 'undefined' ? name : '' %>" />
        </div>
        <div class="form-group">
          <label for="n_licensa_ambiental">Número da Licença Ambiental</label>
          <input type="number" id="n_licensa_ambiental" name="n_licensa_ambiental" class="form-control"
            placeholder="Número da Licença Ambiental" value="<%= typeof number != 'undefined' ? number : '' %>" />
        </div>
        <div class="form-group">
          <label for="v_licensa_ambiental">Validade da Licença Ambiental</label>
          <input type="date" id="v_licensa_ambiental" name="v_licensa_ambiental" class="form-control"
            placeholder="Validade da Licença Ambinental" value="<%= typeof date != 'undefined' ? date : '' %>" />
        </div>
        <div class="form-group">
          <label for="o_licensa_ambiental">Órgão Expeditor da Licença Ambiental</label>
          <input type="name" id="o_licensa_ambiental" name="o_licensa_ambiental" class="form-control"
            placeholder="Òrgão Expeditor da Licença Ambientla" value="<%= typeof name != 'undefined' ? name : '' %>" />
        </div>
        <br>
        <button type="submit" id="cadastrarEmpresa" class="btn btn-primary btn-block">Cadastrar </button>
      </form>
    </div>

  </div>
  <br><br>
  <hr>
  <!-- Fim Cadastros -->

  <!-- Dados PGLS-->
  <h5 class="text-center mb-3"><i class="fab fa-buffer"></i> <a name="secao2"> Dados do PGLS</a></h5>
  <div class="row">

    <!--  Definir Indicadores -->
    <div class="col-lg" style="margin-top: 50px">
      <h5 class="text-left mb-3"><i class="fas fa-tasks"></i> Definir Indicadores</h5>
      <form action="/dashboard/admin0" method="POST">
        <div class="form-group">
          <label for="nome" class="fas fa-thumbtack">Insira um Indicador</label>
          <input type="name" id="nome" name="nome" class="form-control" placeholder="Informe um indicador"
            value="<%= typeof name != 'undefined' ? name : '' %>" />
        </div>
        <button type="submit" class="btn btn-primary btn-block">Cadastrar Indicador</button>
      </form>
      <br><br>
    </div>
    <!-- Definir Metas-->
    <div class="col-lg" style="margin-top: 50px">
      <h5 class="text-left mb-3"><i class="fas fa-tasks"></i> Definir Metas</h5>
      <form action="/dashboard/admin3" method="POST">
        <label for="indicadores"> Selecione o Indicador</label>
        <select name="indicadores" id="indicadores" class="custom-select">
          <% for (var i = 0; i < indicador.length ;i++ ) {%>
          <option value="<%= indicador[i].nome %>"> <%= indicador[i].nome %></option>
          <% } %>
        </select>
        <br>
        <br>
        <div class="form-group">
          <label for="meta" class="fas fa-thumbtack">Insira uma Meta</label>
          <input type="name" id="meta" name="meta" class="form-control" placeholder="Informe uma meta"
            value="<%= typeof name != 'undefined' ? name : '' %>" />
        </div>
        <div class="form-group">
          <label for="data_apuracao_final" class="fas fa-thumbtack">Data de apuração final</label>
          <input type="date" id="data_apuracao_final" name="data_apuracao_final" class="form-control"
            value="<%= typeof date != 'undefined' ? date : '' %>" />
        </div>
        <br>
        <button type="submit" class="btn btn-primary btn-block">Cadastrar Meta</button>
      </form>
      <br><br>
    </div>
    <!--Definir Ações -->
    <div class="col-lg" style="margin-top: 50px">
      <h5 class="text-left mb-3"><i class="fas fa-align-justify"></i> Definir Ações</h5>
      <form action="/dashboard/admin4" method="POST" enctype="multipart/form-data">
        <label for="indicadores1"> Selecione o Indicador</label>
        <select name="indicadores1" id="indicadores1" class="custom-select">
          <% for (var i = 0; i < indicador.length ;i++ ) {%>
          <option value="<%= indicador[i].nome %>"> <%= indicador[i].nome %></option>
          <% } %>
        </select>
        <br>
        <br>
        <!-- 
        <label for="metas"> Selecione a Meta</label>
        <select name="metas" id="metas" class="custom-select">
          <% for (var i = 0; i < metas.length ;i++ ) {%>
          <option value="<%= metas[i].meta %>"> <%= metas[i].meta %></option>
          <% } %>
        </select>-->

        <label for="metas"> Selecione a Meta</label>
        <select name="metas" id="metas1" class="custom-select">
          <option value="">Aguardando seleção de meta...</option>
        </select>
        <br>
        <br>
        <div class="form-group">
          <label for="acao" class="fas fa-file-export">Insira uma ação</label>
          <input type="name" id="acao" name="acao" class="form-control" placeholder="Informe uma Ação"
            value="<%= typeof name != 'undefined' ? name : '' %>" />
        </div>
        <br>
        <button type="submit" class="btn btn-primary btn-block"> Cadastrar Ação</button>
      </form>
    </div>
    <br><br>
  </div>
  <hr>
  <!-- FIM Dados PGLS-->

  <!-- Listas e Detalhes-->
  <h5 class="text-center mb-3"><i class="fab fa-buffer"></i><a name="secao3"> Listas e Detalhes </a></h5>
  <div class="row">
    <!--Inserir funcionários nas ações -->
    <div class="col-lg" style="margin-top: 20px">
      <h5 class="text-center mb-3"><i class="fab fa-buffer"></i> Inserir Funcionários nas Ações </h5>
      <form action="/dashboard/adminFuncionario" method="POST">
        <label for="acoes"> Selecione a Ação</label>
        <select name="acoes" id="acoes" class="custom-select">
          <% for (var i = 0; i < acoes.length ;i++ ) {%>
          <option value="<%= acoes[i].acao %>"> <%= acoes[i].acao %></option>
          <% } %>
        </select>
        <br><br>
        <label for="nomeFuncionario"> Selecione o funcionário</label>
        <select id="nomeFuncionario" name="nomeFuncionario" class="custom-select">
          <% for (var i = 0; i < usuarios.length ;i++ ) {%>
          <option value="<%= usuarios[i].name %>"> <%= usuarios[i].name %> </option>
          <% } %>
        </select>
        <br>
        <br>
        <button type="submit" class="btn btn-primary btn-block"> Inserir Funcionário na Ação</button>
      </form>
      <!-- Tabela ? -->
      <br><br>
    </div>
    <!-- Detalhes das Ações-->
    <div class="col-lg" style="margin-top: 20px">
      <h5 class="text-center mb-3"><i class="fab fa-buffer"></i> Listar Detalhes das Ações </h5>
      <form action="/dashboard/adminDetalhes" method="GET">
        <label for="acoes"> Selecione a Ação</label>
        <select name="acoes" id="acoes1" class="custom-select">
          <% for (var i = 0; i < acoes.length ;i++ ) {%>
          <option value="<%= acoes[i].acao %>"> <%= acoes[i].acao %></option>
          <% } %>
        </select>
        <br>
        <!-- <button type="submit" class="btn btn-primary btn-block"> Ver Detalhes</button> -->
        <!-- Tabela de Resultados-->
        <br>
        <table class="table table-striped">
            <tr>
              <th>Funcionários executando a Ação</th>
            </tr>
            <tr>
              <td id="nomefuncionarioacao">Nome do Funcionário</td>
            </tr>
        </table>
      </form>
    </div>
    <br><br>
  </div>
  <a href="#Home" style="padding-left: 535px">Topo</a>
  <br>
  <br>
  <!-- FIM Listas e Detalhes-->
</div>
<script>
  document.getElementById("indicadores1").addEventListener('change', (event) => {
    $("#metas1").find("option").remove();
    let indicador_atual = event.target.value;
    console.log(indicador_atual);
    var len = parseInt("<%= JSON.stringify(metas.length) %>");
    console.log(len);
    // var todasMetas = ("<%= JSON.stringify(metas) %>");
    // console.log(todasMetas);

    var allMetas = { indicadores: [], meta: [], data_apuracao_final: [] };
    // for(var i=0; i < len ;i++){
    "<% for (var i =0; i < metas.length ; i++ )  { %>"
    allMetas.indicadores.push("<%= metas[i].indicadores %>"),
      allMetas.meta.push("<%= metas[i].meta %>"),
      allMetas.data_apuracao_final.push("<%= metas[i].data_apuracao_final %>")
    "<% } %> "
    // }
    console.log(allMetas);
    // var todasMetas = JSON.stringify(allMetas);
    // console.log(todasMetas);

    var options = [];
    for (var i = 0; i < len; i++) {
      if (allMetas.indicadores[i] == indicador_atual) {
        console.log(allMetas.meta[i]);
        options.push(allMetas.meta[i]);
      }
    }
    // console.log(options);
    /*
     let options = allMetas.map(function(metas, index, pos, arr) {
       if (metas.indicadores == indicador_atual)
         return metas.meta;
     }) 
     console.log(options);*/
    for (var i = 0; i < options.length; i++) {
      // $("#metas1").find("option").remove();
      $("#metas1").append(`<option value="${options[i]}">${options[i]}</option>`);
    }
  });

  document.getElementById("acoes1").addEventListener('change', (event) => {
    $("#nomefuncionarioacao").find("td").remove();
    let acao_atual = event.target.value;
    console.log(acao_atual);
    var len = parseInt("<%= JSON.stringify(acao.length) %>");
    console.log(len);
    // var todasMetas = ("<%= JSON.stringify(metas) %>");
    // console.log(todasMetas);

    var allAcao = { acao:[], nomeFuncionario: [] };
    // for(var i=0; i < len ;i++){
    "<% for (var i =0; i < acao.length ; i++ )  { %>"
    allAcao.acao.push("<%=acao[i].acao%>"),
    allAcao.nomeFuncionario.push("<%= acao[i].nomeFuncionario %>")
    "<% } %> "
    // }
    console.log(allAcao);
    // var todasMetas = JSON.stringify(allMetas);
    // console.log(todasMetas);
    
    var options = [];
    for (var i = 0; i < len; i++) {
      if (allAcao.acao[i] == acao_atual) {
        console.log(allAcao.nomeFuncionario[i]);
        options.push(allAcao.nomeFuncionario[i]);
      }
    }
    // console.log(options);
    /*
     let options = allMetas.map(function(metas, index, pos, arr) {
       if (metas.indicadores == indicador_atual)
         return metas.meta;
     }) 
     console.log(options);*/
    for (var i = 0; i < options.length; i++) {
      // $("#metas1").find("option").remove();
      $("#nomefuncionarioacao").append(`<td value="${options[i]}">${options[i]}</td>`);
    }
  });

</script>